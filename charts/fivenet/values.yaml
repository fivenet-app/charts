# Default values for fivenet.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 2000

# -- Security context (the provided values work with the official container image) https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 2000
  runAsGroup: 2000
  seccompProfile:
    type: RuntimeDefault

service:
  type: ClusterIP

nodeSelector: {}

tolerations: []

affinity: {}
  # Example soft pod anti affinity rule
  #podAntiAffinity:
  #  preferredDuringSchedulingIgnoredDuringExecution:
  #    - podAffinityTerm:
  #        labelSelector:
  #          matchExpressions:
  #            - key: app.kubernetes.io/name
  #              operator: In
  #              values:
  #                - fivenet
  #        topologyKey: kubernetes.io/hostname
  #      weight: 100

ingress:
  # -- If an ingress object should be created.
  enabled: true
  # -- Ingress class name
  className: "nginx"
  annotations: {}
    # kubernetes.io/tls-acme: "true"
    #nginx.ingress.kubernetes.io/ssl-redirect: "true"
    #nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    #nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

ingressGRPC:
  # -- If an ingress object for GRPC API access should be created. Requires TLS certs for HTTPS and a separate subdomain. Used for DBSync and the plugin API.
  enabled: true
  # -- Ingress class name
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "2400"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "2400"
    nginx.ingress.kubernetes.io/use-regex: "true"
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example-grpc.local
      paths:
        - path: /services.+
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example-grpc.local

fivenet:
  # -- FiveNet config, make sure to checkout the [config reference documentation](https://fivenet.app/getting-started/configuration/config-reference)
  config:
    # Debug or release mode (affects performance)
    mode: "release"

    # Can be "DEBUG", "INFO", "WARN", "ERROR", "FATAL"
    logLevel: "INFO"
    # Customize log level for specific components (if empty will use the global logLevel, can never be more verbose than the global logLevel)
    logLevelOverrides:
      kvstore: "INFO"
      locks: "INFO"
      cron: "INFO"
      perms: "INFO"

    # Must be 32 chars (bytes) long
    secret: "your_generated_db_secret_32_char"

    jwt:
      secret: "your_generated_jwt_secret"

    http:
      listen: ":8080"
      adminListen: ":7070"
      publicURL: "https://fivenet.example.com"
      origins:
        - "https://fivenet.example.com"
        #- "http://localhost:3000" # Only for development
      trustedProxies: []
        #- "127.0.0.1" # Only for development
      sessions:
        cookieSecret: "your_generated_cookie_secret"
        domain: "fivenet.example.com"

    database:
      # Refer to https://github.com/go-sql-driver/mysql#dsn-data-source-name for details
      # Please note that the `parseTime` parameter is allows set to true
      dsn: "DB_USER:DB_PASS@tcp(DB_HOST:DB_PORT)/DB_NAME?collation=utf8mb4_unicode_ci&loc=Europe%2FBerlin"
      maxOpenConns: 32
      maxIdleConns: 5
      connMaxIdleTime: 15m
      connMaxLifetime: 60m
      # Must be enabled if using a gameserver database (with ESX tables) and not wanting to use the dbsync
      esxCompat: true
      custom:
        # To disable a column, set it to `"-"`
        columns:
          user:
            visum: "visum"
            playtime: "playtime"
          vehicle:
            model: "model"
        conditions:
          user:
            filterEmptyName: false

    nats:
      # This NATS url is for using the NATS server from the `docker-compose.yaml`
      # If you change the NATS username or password, below `nats:` config section
      url: "nats://fivenet:fivenet_topsecret@nats:4222"
      replicas: 1
      # Other NATS authentication options:
      #nKey: null
      #creds: null

    storage:
      type: "filesystem"
      filesystem:
        path: ".data/"
        prefix: ""
      s3:
        endpoint: ""
        region: "us-east-1"
        accessKeyID: ""
        secretAccessKey: ""
        useSSL: true
        bucketName: ""
        prefix: ""
        retries: 3
        checkOnStartup: false

    imageProxy:
      enabled: true
      url: "/api/image_proxy/"
      cachePrefix: "images/"
      options:
        allowHosts: []
        denyHosts: []

    audit:
      retentionDays: 90

    oauth2:
      providers: []
      #  - name: "discord"
      #    label: "Discord"
      #    homepage: "https://discord.com"
      #    icon: "i-simple-icons-discord" # or an image URL
      #    #defaultAvatar: ""
      #    type: "discord"
      #    redirectURL: "https://localhost:3000/api/oauth2/callback/discord"
      #    clientID: "your_discord_oauth2_client_id"
      #    clientSecret: "your_discord_oauth2_client_secret"
      #    scopes:
      #      - guilds
      #      - identify
      #    endpoints:
      #      authURL: "https://discord.com/api/oauth2/authorize"
      #      tokenURL: "https://discord.com/api/oauth2/token"

    postalsFile: ".output/public/data/postals.json"

    auth:
      superuserGroups:
        - projektleiter
        - teamleitung
      superuserUsers: []

    dispatchCenter:
      type: "gksphone"
      convertJobs: []
        #- police

    discord:
      enabled: false
      dryRun: false
      token: "your_discord_bot_token"
      sync: true

      groupSync:
        enabled: false
        mapping:
          fraktionsverwaltung:
            roleName: "Fraktionsverwaltung"
            #permissions: 0
            #color: "#9B59B6"
            notSameJob: true
          teamleitung:
            roleName: "Teamleitung"
            #permissions: 0
            #color: "#9B59B6"
      userInfoSync:
        enabled: false
        gradeRoleFormat: "[%grade%] %grade_label%"
        employeeRoleFormat: "%s Employees"
        unemployedRoleName: "Citizen"
        jobsAbsceneRoleName: "Absent"
      qualifications:
        enabled: true
      commands:
        enabled: true

        # Toggle the availability of individual commands.
        absent: true
        fivenet: true
        help: true
        sync: true

    game:
      # First grade "number/id", some servers start at 0, but I have seen some start at 1
      startJobGrade: 0
      # If enabled it will automatically delete roles which no jobs/grades are found for
      cleanupRolesForMissingJobs: false

    sync:
      enabled: false
      apiTokens: []
        #- LONG_RANDOM_API_TOKEN_FOR_DBSYNC

    otlp:
      enabled: false
      # Can be "stdout", "grpc", "http"
      type: "stdout"
      # OTLP endpoint URL (must include `http(s)://`)
      url: "http://localhost:4317"
      insecure: false
      timeout: 10s
      environment: "live"
      ratio: 0.1
      attributes:
      # - service.name=fivenet-server
        - k8s.namespace.name=${POD_NAMESPACE}
      headers: {}
        # Example to authenticate with an API key
        #authorization: "OTEL_API_KEY_HERE"
      # Can be "none" or "gzip"
      compression: "none"
      frontend:
        url: ""
        headers: {}
          # Example to authenticate with an API key
          #authorization: "OTEL_API_KEY_HERE"

    updateCheck:
      # If enabled, it will check for updates every interval.
      enabled: true
      # Interval for checking updates, e.g., "1h", "30m", "15s"
      interval: "6h"

    icons:
      # If true, the Iconify API is enabled and will be served from the backend to serve icons.
      enabled: true
      # If true, the backend server will act as a proxy for the Iconify API (URL specified via `APIURL` setting).
      proxy: false
      # If you are using the proxy mode, make sure to support the Iconify project: https://iconify.design/sponsors/
      apiUrl: "https://api.iconify.design"
      # Path to the directory containing icon sets (used when proxy is disabled; this path works with the official FiveNet container images).
      path: ./icons

# -- Additional environment variables to set in the server, worker and discord pods
additionalEnv: []
  # - name: TZ
  #   value: "Europe/Berlin"

# -- Additional volumes to mount into the server, worker and discord pods
additionalVolumes: []
  # - name: fivenet-data
  #   persistentVolumeClaim:
  #     claimName: fivenet-data-pvc

# -- Additional volume mounts to mount into the server, worker and discord pods
additionalVolumeMounts: []
  # - name: fivenet-data
  #   mountPath: /data

# -- Migration job config
migration:
  # -- Specifies whether the migration job should be created
  enabled: true

server:
  enabled: true
  replicaCount: 1
  revisionHistoryLimit: 1
  image:
    repository: ghcr.io/fivenet-app/fivenet
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi
  livenessProbe:
    httpGet:
      path: /readiness
      port: metrics
    failureThreshold: 3
    initialDelaySeconds: 25
    periodSeconds: 10
  readinessProbe: null
  startupProbe:
    httpGet:
      path: /readiness
      port: metrics
    failureThreshold: 30
    initialDelaySeconds: 20
    periodSeconds: 10
  # -- Additional environment variables (e.g., to set the timezone via the TZ variable)
  additionalEnv: []
    # - name: TZ
    #   value: "Europe/Berlin"
  # -- Arguments to pass to the container command
  args:
    - server

# -- Prometheus-operator ServiceMonitor config
serviceMonitor:
  # -- Specifies whether a prometheus-operator ServiceMonitor should be created
  enabled: false
  # -- Additional Labels for the ServiceMonitor object
  additionalLabels: {}
  #namespace: "monitoring"
  namespaceSelector:
  # Default: scrape .Release.Namespace only
  # To scrape all, use the following:
  #  matchNames:
  #    - monitoring
  #   any: true
  # -- (duration) Interval at which metrics should be scraped
  scrapeInterval: 30s
  # honorLabels: true

# -- FiveNet Worker deployment config
worker:
  enabled: true
  replicaCount: 1
  revisionHistoryLimit: 1
  image:
    repository: ghcr.io/fivenet-app/fivenet
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi
  livenessProbe:
    httpGet:
      path: /readiness
      port: metrics
    initialDelaySeconds: 15
    periodSeconds: 10
  readinessProbe: null
  startupProbe:
    httpGet:
      path: /readiness
      port: metrics
    initialDelaySeconds: 5
    failureThreshold: 20
    periodSeconds: 10
  # -- Additional environment variables (e.g., to set the timezone via the TZ variable)
  additionalEnv: []
  # -- Arguments to pass to the container command
  args:
    - worker

# -- FiveNet Discord Bot deployment config
discord:
  enabled: true
  replicaCount: 1
  revisionHistoryLimit: 1
  image:
    repository: ghcr.io/fivenet-app/fivenet
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi
  livenessProbe:
    httpGet:
      path: /readiness
      port: metrics
    initialDelaySeconds: 15
    periodSeconds: 10
  readinessProbe: null
  startupProbe:
    httpGet:
      path: /readiness
      port: metrics
    initialDelaySeconds: 5
    failureThreshold: 20
    periodSeconds: 10
  # -- Additional environment variables (e.g., to set the timezone via the TZ variable)
  additionalEnv: []
  # -- Arguments to pass to the container command
  args:
    - discord

# -- FiveNet DBSync deployment config
dbsync:
  enabled: false
  replicaCount: 1
  revisionHistoryLimit: 1
  # -- Deployment strategy
  strategy:
    type: Recreate
  image:
    repository: ghcr.io/fivenet-app/fivenet
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi
  # Currently the DBSync doesn't have any health endpoints, so they should be left as null
  livenessProbe: null
  readinessProbe: null
  startupProbe: null
  # -- Additional environment variables (e.g., to set the timezone via the TZ variable)
  additionalEnv: []
  # -- Arguments to pass to the container command
  args:
    - dbsync
    - run
  # -- Persistence configuration (will be mounted at `/state`)
  persistence:
    # -- It is recommended to enable persistence to ensure the state file.
    enabled: false
    # storageClassName: default
    # -- (Optional) Use this to bind the claim to an existing PersistentVolume (PV) by name.
    volumeName: ""
    accessModes:
      - ReadWriteOnce
    # -- Requested size of the PersistentVolumeClaim (PVC).
    size: 1Gi
    annotations: {}
    finalizers:
      - kubernetes.io/pvc-protection
    # selectorLabels: {}
    ## Sub-directory of the PV to mount. Can be templated.
    # subPath: ""
    ## Name of an existing PVC. Can be templated.
    # existingClaim:
    ## Extra labels to apply to a PVC.
    extraPvcLabels: {}

  # -- DBSync config - This only shows some of the most important options, for all options please refer to the [DBSync configuration reference](https://fivenet.app/getting-started/configuration/dbsync-config-reference)
  config:
    # Can be "DEBUG", "INFO", "WARN", "ERROR", "FATAL"
    logLevel: "INFO"

    # Helm chart changes will cause the DBSync deployment to be restarted, no need to watch the config.
    watchConfig: false
    # Path to the state file (will be created automatically if it doesn't exist) - Should be on a volume (PVC).
    stateFile: "/state/dbsync.state.yaml"

    # Your **gameservers' database** details
    # Changes to the source require a restart of the dbsync!
    source:
      # Refer to https://github.com/go-sql-driver/mysql#dsn-data-source-name for details
      # Please note that the `parseTime` parameter is always set to true
      dsn: "DB_USER:DB_PASS@tcp(DB_HOST:DB_PORT)/DB_NAME?collation=utf8mb4_unicode_ci&loc=Europe%2FBerlin"
      # Example for a locally hosted database
      #dsn: "fivenet:changeme@tcp(localhost:3306)/fivenet?collation=utf8mb4_unicode_ci&loc=Europe%2FBerlin"
      #
      # Or use individual parameters (make sure to comment out the `dsn:` line above if you use these).
      # Hint: you can set these via environment variables as well, e.g., FIVENET_DATABASE_HOST, FIVENET_DATABASE_PORT,
      # FIVENET_DATABASE_USERNAME, FIVENET_DATABASE_PASSWORD, FIVENET_DATABASE_DATABASE
      #host: "localhost"
      #port: 3306
      #username: "fivenet"
      #password: "changeme"
      #database: "fivenet"

      # Advanced connection settings
      maxOpenConns: 12
      maxIdleConns: 5
      connMaxIdleTime: 10m
      connMaxLifetime: 45m
      disableLocking: false

      # Interval in which base data (jobs, job grades, licenses) is re-synced fully
      baseDataResyncInterval: 5m

    # The target FiveNet instance to sync data to (the instance must have the sync API enabled and you need a valid token)
    destination:
      # Sync method to use, currently only `api` is supported, which uses the FiveNet Sync API to sync data to FiveNet.
      method: "api"
      # Your FiveNet Sync API details.
      api:
        # Your FiveNet Hostname, with port if your port is not 443 (HTTPS),
        # requires the FiveNet instance to **use HTTPS**.
        # ! Make sure to not include the protocol (http:// or https://) here!
        # ! Don't include a trailing slash!
        #
        # Example:
        # 'https://demo.fivenet.app'   -> 'demo.fivenet.app:443'
        # 'https://fivenet.example.com' -> 'fivenet.example.com:443'
        url: "fivenet.example.com"
        token: "YOUR_SYNC_API_TOKEN"
        # Timeout for API requests
        timeout: 5s

        # Disable TLS verification (not recommended)
        insecure: false
        # Advanced: Only disable if you know what you are doing!
        transportSecurity: true

      # Sync Interval can also be specified per table in the `tables:` section
      syncInterval: 5s
      # If you want to test your configuration without actually syncing data to FiveNet
      # you can enable the `dryRun` mode,
      # which will log the data that would be synced instead of sending it to FiveNet.
      # This is useful for testing and debugging your configuration.
      dryRun: false

    # A query for each "piece of data" FiveNet needs to function
    # The example table names + columns and queries are for the ESX framework
    tables:
      # Jobs of your game server (e.g., police, ambulance, taxi, etc., with their name and label/display name)
      jobs:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "jobs"
        # Jobs table column names (only used when no custom `query` is specified)
        columns:
          name: "name"
          label: "label"
        # Custom query to retrieve the jobs (you must return the required columns)
        #
        # Must return result columns named: `job.name`, `job.label`
        #query: |
        #  SELECT
        #    `name` AS `job.name`,
        #    `label` AS `job.label`
        #  FROM
        #    `jobs`
        #  ORDER BY `name`
        #  OFFSET $offset;
        filters: []
          # Example filter to drop jobs starting with "off_", to enable uncomment this section
          # This is useful in combination with the `users:` jobs filters below if you
          # have "off-duty" jobs that need to be rewritten to their "actual" job name
          #- pattern: '^off_'
          #  action: drop

      # Job grades for the jobs, e.g., "police" job has the grades "0", "1", "2", etc. with different
      # labels and names.
      jobGrades:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "job_grades"
        # Job grades table column names (only used when no custom `query` is specified)
        columns:
          jobName: "job_name"
          grade: "grade"
          name: "name"
          label: "label"
        # Custom query to retrieve the job grades data (you must return the required columns)
        #
        # Must return result columns named: `job_grade.job_name`, `job_grade.grade`, `job_grade.name`, `job_grade.label`
        # (With a `WHERE`-condition for the `job_name` column using the `$jobName` parameter)
        #query: |
        #  SELECT
        #    `job_name` AS `job_grade.job_name`,
        #    `grade` AS `job_grade.grade`,
        #    `name` AS `job_grade.name`,
        #    `label` AS `job_grade.label`
        #  FROM
        #    `job_grades`
        #  WHERE
        #    `job_grades`.`job_name` = $jobName
        #  ORDER BY `job_grade.job_name`, `job_grade.grade`
        #  OFFSET $offset;

      # Licenses available on your server, e.g., driver's license, weapon license, etc.
      licenses:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "licenses"
        # Licenses table column names (only used when no custom `query` is specified)
        columns:
          type: "type"
          label: "label"
        # Custom query to retrieve the available licenses (not per user, see `userLicenses:` below)
        #
        # Must return result columns named: `license.type`, `license.label`
        #query: |
        #  SELECT
        #    `licenses`.`type` AS `license.type`,
        #    `licenses`.`label` AS `license.label`
        #  FROM
        #    `licenses`
        #  ORDER BY `type`
        #  LIMIT $limit
        #  OFFSET $offset;

      # Users/Characters of the game server - This is the main users table,
      # which is used to link to other data to (e.g., vehicles, users' licenses)
      users:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "users"
        # If your "players"/"users" data has a timestamp/datetime column that is updated on update,
        # configure it here so that after the initial sync only the changed data is synced again.
        updatedTimeColumn: "last_seen"
        # Users table column names (used to build the default query if no custom `query` is specified)
        # **NOTE**: The `id` and `identifier` columns are required to be set, even when a custom query is used.
        # They are used to build the where condition for incremental syncs.
        columns:
          id: "id"
          identifier: "identifier"
          group: "group"
          firstname: "firstname"
          lastname: "lastname"
          dateOfBirth: "dateofbirth"
          sex: "sex"
          height: "height"
          job: "job"
          jobGrade: "job_grade"
          phoneNumber: "phone_number"
          # Optional columns
          visum: "-" # Indicates that this column is not available
          playtime: "-" # Indicates that this column is not available
        # Custom query to retrieve users data.
        # The identifier column should be a smart combination of values when using a multichar system.
        # E.g., it is prefered to use a ESX like identifier layout for that case `charX:LICENSE`
        #
        # Must return result columns named: `user.user_id`, `user.identifier`, `user.group`, `user.firstname`,
        # `user.lastname`, `user.dateofbirth`, `user.job`, `user.job_grade`, `user.sex` columns
        # Optional columns: `user.phone_number`, `user.height`, `user.visum`, `user.playtime`
        #
        # For advanced users: If an user can has more than one job (e.g., a main job and a secondary job),
        # you should use the `userJobs:` section to query the job(s) of the users instead of returning multiple rows per user in this query, to prevent data duplication and potential performance issues.
        #
        # If an user can has multiple phone numbers, you can return multiple rows per user with the phone number
        # data in the columns `user_phone_number.number` and `user_phone_number.is_primary` (boolean column
        # to indicate the primary phone number, if multiple phone numbers are returned).
        #query: |
        #  SELECT
        #    `id` AS `user.id`,
        #    `identifier` AS `user.identifier`,
        #    `group` AS `user.group`,
        #    `firstname` AS `user.firstname`,
        #    `lastname` AS `user.lastname`,
        #    `dateofbirth` AS `user.dateofbirth`,
        #    `sex` AS `user.sex`,
        #    `height` AS `user.height`,
        #    `job` AS `user.job`,
        #    `job_grade` AS `user.job_grade`,
        #    `phone_number` AS `user.phone_number`,
        #    `visum` AS `user.visum`,
        #    `playtime` AS `user.playtime`
        #  FROM
        #    `users`
        #  $whereCondition
        #  ORDER BY `id`
        #  LIMIT $limit
        #  OFFSET $offset;
        # If a lastname is not returned by the query, attempt to split the firstname into "two" parts
        splitName: true
        # Normalize date of birth value to the output format if possible
        # Please see the Go `time` pkg documentation on potential date format layouts: https://pkg.go.dev/time#Layout
        dateOfBirth:
          formats:
            - "2006-01-02" # 2000-10-18 = YYYY-MM-DD
            - "02/01/2006" # 09/06/1993 = MM/DD/YYYY
            - "02.01.2006" # 01.08.1982 = DD.MM.YYYY
          outputFormat: "02.01.2006" # DD.MM.YYYY
        valueMapping:
          # This allows to map values to different values for FiveNet
          # E.g., the sex of a char must be either `m`, `f`, or `d`
          sex:
            fallback: 'm'
            values:
              '1': 'f'
        # If the firstname or lastname is empty or null, do not sync the user at all
        ignoreEmptyNames: true
        # Filters allow to modify certain values before they are sent to FiveNet
        filters:
          jobs: []
            # Example: `off_police` -> `police`
            #- pattern: '^off_'
            #  action: replace
            #  replacement: ''
            # Example: `ambulance` -> `ems`
            #- pattern: '^ambulance$'
            #  action: replace
            #  replacement: 'ems'

      # Licenses of a user
      userLicenses:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "user_licenses"
        # User licenses table column names (only used when no custom `query` is specified)
        columns:
          type: "type"
          ownerIdentifier: "owner"
        # Custom query to retrieve the licenses for a **specific** user, the `$identifier` parameter is the placeholder for the user's identifier
        #
        # Must return result columns named: `user_license.type`, `user_license.owner`
        #query: |
        #  SELECT
        #    `type` AS `user_license.type`,
        #    `owner` AS `user_license.owner`
        #  FROM
        #    `user_licenses`
        #  WHERE
        #    `user_licenses`.`owner` = $identifier
        #  ORDER BY `type`
        #  LIMIT $limit
        #  OFFSET $offset;

      # Jobs of a user (if your users can have multiple jobs, e.g., a main job and a secondary job, it is recommended to enable and use this
      # and return the jobs in a separate query to prevent data duplication and potential performance issues,
      # otherwise you can also return the job data in the main users query)
      userJobs:
        enabled: false
        # Custom query to retrieve the jobs for a **specific** user, the `$userId` and `$identifier`
        # parameters are the placeholder for the user's user id/identifier.
        #
        # Must return result columns named: `user_job.job`, `user_job.grade`
        # Optional but recommended: `user_job.is_primary` (boolean column to indicate if it is the primary job,
        # if multiple jobs are returned, otherwise the first is set as primary)
        #query: |
        #  SELECT
        #    `job` AS `user_job.job`,
        #    `grade` AS `user_job.grade`
        #    1 AS `user_job.is_primary`
        #  FROM
        #    `user_jobs`
        #  WHERE
        #    `user_jobs`.`owner` = $identifier
        #  ORDER BY `owner`
        #  LIMIT $limit
        #  OFFSET $offset;

      # User Phone Numbers (if your users can have multiple phone numbers,
      # it is recommended to enable and use this
      userPhoneNumbers:
        enabled: false
        # Custom query to retrieve the phone numbers for a **specific** user, the `$userId` and `$identifier`
        # parameters are the placeholder for the user's user id/identifier.
        #
        # Must return result columns named: `user_phone_number.number`, `user_phone_number.is_primary`
        query: |
          SELECT
            `phone_number` AS `user_phone_number.number`,
            (ROW_NUMBER() OVER (ORDER BY `is_primary` DESC) = 1) AS `user_phone_number.is_primary`
          FROM user_phone_numbers
          WHERE user_phone_numbers.identifier = $identifier
          ORDER BY `is_primary` DESC, `phone_number`;

      # Vehicles owned by users
      vehicles:
        enabled: true
        # Name of the table for this data (in case you are using a custom query or are joining
        # multiple tables this should be the primary one)
        tableName: "owned_vehicles"
        # By default the dbsync will attempt to add the column if it does not exist, but you can
        # disable that by commenting this out. It is recommended to leave it enabled, for
        # performance reasons.
        updatedTimeColumn: "updated_at"
        # Vehicles table column names (only used when no custom `query` is specified)
        columns:
          ownerIdentifier: "owner"
          # Use this if vehicles are linked by user DB ID instead of identifier
          #ownerId: "owner"
          plate: "plate"
          type: "type"
          model: "-" # Indicates that this column is not available
        # Custom query to retrieve all vehicles
        #
        # Must return result columns named: `vehicle.owner_id` (the user's DB ID) or `vehicle.owner_identifier`,
        # `vehicle.plate`, `vehicle.type`
        # Optional columns: `vehicle.model`, `vehicle.job` (for job specific vehicles)
        #query: |
        #  SELECT
        #    `owner` AS `vehicle.owner_identifier`,
        #    `plate` AS `vehicle.plate`,
        #    `type` AS `vehicle.type`,
        #    `model` AS `vehicle.model`
        #  FROM
        #    `owned_vehicles`
        #  ORDER BY `vehicle.plate`
        #  LIMIT $limit
        #  OFFSET $offset;

      # Accounts - Used to, e.g., sync group(s) by license, to accounts.
      accounts:
        enabled: false
        tableName: "admin_accounts"
        # By default the dbsync will attempt to add the column if it does not exist, but you can
        # disable that by commenting this out. It is recommended to leave it enabled, for
        # performance reasons.
        updatedTimeColumn: "updated_at"
        # Query to retrieve account data (example query to show how to retrieve
        # account primary group and sub groups (using `JSON_*` funcs)).
        #
        # Must return result columns named: `account.license`, `account.group` (primary group)
        # Optional columns: `account.groups` (comma-separated list of groups, if `account.group` is
        # empty `account.group` is used)
        query: "" # Query to retrieve all accounts
        #  SELECT
        #    `license` AS `account.license`,
        #    `group` AS `account.group`,
        #    JSON_KEYS(NULLIF(`sub_groups`, '')) AS `account.groups`
        #  FROM
        #    `admin_accounts`
        #  $whereCondition
        #  ORDER BY `license`
        #  LIMIT $limit
        #  OFFSET $offset;

    tableManager:
      # By default enabled, used to create missing `updated_at` columns (`updatedTimeColumn`) on tables that have it configured.
      enabled: true

    # Limit the amount of data to sync per query, this is useful to prevent syncing too much data at once which can cause performance issues or timeouts.
    # The default numbers are the maximum allowed by the sync API, you can lower them if you experience performance issues or timeouts, but you cannot increase them above these values.
    limits:
      jobs: 200
      licenses: 200
      users: 150
      vehicles: 500
      accounts: 100

# -- NATS server/cluster config values: https://artifacthub.io/packages/helm/nats/nats#values
nats:
  # -- If disabled you must run your own Nats server or cluster.
  enabled: true
  config:
    cluster:
      enabled: true
      replicas: 3
    jetstream:
      enabled: true
      fileStore:
        enabled: true
        pvc:
          enabled: true
          size: 5Gi
          #storageClassName: default
      memoryStore:
        enabled: true
        # ensure that container has a sufficient memory limit greater than maxSize
        maxSize: 64Mi

    merge:
      accounts:
        fivenet:
          jetstream: enabled
          users:
            # You should change the username and password
            - user: "fivenet"
              password: "fivenet"
      # User tracker can create big update events
      max_payload: 3145728

  promExporter:
    enabled: true
    image:
      repository: docker.io/natsio/prometheus-nats-exporter

    podMonitor:
      enabled: false # enable only if your have the prometheus-operator deployed
      patch:
        - op: add
          path: /spec/podMetricsEndpoints/0/interval
          value: 30s

# -- Extra objects to deploy (value evaluated as a template)
extraObjects: []
